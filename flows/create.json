{
    "id": "flow_factory",
    "steps": [
        {
            "id": "log_data",
            "type": "selector",
            "source": "~/fast-flows/logs",
            "prompt": "Which session do you want to turn into an automation?"
        },
        {
            "id": "draft_flow",
            "model": "gemini-3-flash-preview",
            "prompt": "Analyze this chat log: {{log_data}}.\n\nCreate a Fast Flow JSON file that automates the task performed in this log. \n\n### SCHEMA REFERENCE\nReturn a JSON object with this structure:\n```json\n{\n  \"model\": \"gemini-2.0-flash\",\n  \"system_prompt\": \"...\",\n  \"steps\": [\n    {\n      \"id\": \"step_id\",\n      \"type\": \"text\", // or \"interaction\", \"selector\", \"file_write\"\n      \"prompt\": \"Instructions for AI...\"\n    }\n  ]\n}\n```\n\n### RULES\n1. **Variables:** \n   - **CRITICAL:** Use `{{clipboard}}` for the main data input. If the user in the log says 'convert this' or pastes text, that text is `{{clipboard}}`. \n   - Use `{{input}}` if the user provided a short topic or instruction at the start.\n   - Use `{{step_id}}` to chain results.\n2. **Efficiency:** \n   - Combine instructions into fewer steps. Avoid redundant 'setup' steps that don't produce output.\n   - Do NOT create a separate step just to ask for input if `{{clipboard}}` or `{{input}}` can be used directly in the prompt.\n3. **User Input:** Only use `\"type\": \"interaction\"` if the flow requires *interactive* back-and-forth or specific clarification *during* execution.\n4. **Output:** Return ONLY raw JSON. Do NOT use markdown code blocks (no ```json). This is critical."
        },
        {
            "id": "user_review",
            "type": "flow_editor",
            "prompt": "{{draft_flow}}"
        },
        {
            "id": "ask_filename",
            "type": "interaction",
            "prompt": "What should we name this flow? (e.g. my_flow)",
            "if": "{{user_review}} != 'no'"
        },
        {
            "id": "save_file",
            "type": "file_write",
            "filename": "~/fast-flows/flows/{{ask_filename}}.json",
            "content": "{{user_review}}",
            "if": "{{user_review}} != 'no'"
        }
    ]
}